<!DOCTYPE html>
<html>
<head>
    <title>Furniture Work Bill Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 30px;
            background: #f4f4f4;
        }
        .container {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        input {
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        table th, table td {
            border: 1px solid #ccc;
            padding: 8px;
        }
        table th {
            background-color: #eee;
        }
        .btn {
            padding: 8px 14px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            margin-top: 15px;
            cursor: pointer;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>

<div class="container" id="billContent">
    <h2>Rana Wood Works, Vapi</h2>
    <h2>Prop - Lalu Rana</h2>
    <h2>Phone - 6200421418</h2>
    <h3>Address - Vapi, Gujarat</h3>

    <label>Client Name:</label>
    <input type="text" id="clientName" placeholder="e.g., Mr. Sharma" />
    &nbsp;&nbsp;
    <label>Date:</label>
    <input type="date" id="billDate" />
    
    <table id="billTable">
        <thead>
            <tr>
                <th>S.No.</th>
                <th>Description</th>
                <th>Area (sq. ft)</th>
                <th>Unit Price</th>
                <th>Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="billBody">
            <!-- Sample row -->
            <tr>
                <td>1</td>
                <td><input type="text" class="desc" /></td>
                <td><input type="number" class="area" oninput="calculateTotals()" /></td>
                <td><input type="number" class="unit" oninput="calculateTotals()" /></td>
                <td><input type="text" class="total" readonly /></td>
                <td><button class="btn btn-danger" onclick="removeRow(this)">‚ùå</button></td>
            </tr>
        </tbody>
    </table>

    <button class="btn" onclick="addRow()">‚ûï Add Row</button>
    <br><br>
    <h3>Total Amount: ‚Çπ<span id="grandTotal">0.00</span></h3>
</div>

<br>
<button class="btn" onclick="downloadPDF()">üìÑ Download PDF</button>

<script>
function addRow() {
    const table = document.getElementById("billBody");
    const rowCount = table.rows.length + 1;

    const row = table.insertRow();
    row.innerHTML = `
        <td>${rowCount}</td>
        <td><input type="text" class="desc" /></td>
        <td><input type="number" class="area" oninput="calculateTotals()" /></td>
        <td><input type="number" class="unit" oninput="calculateTotals()" /></td>
        <td><input type="text" class="total" readonly /></td>
        <td><button class="btn btn-danger" onclick="removeRow(this)">‚ùå</button></td>
    `;
}

function removeRow(button) {
    const row = button.closest("tr");
    row.remove();
    updateSerials();
    calculateTotals();
}

function updateSerials() {
    const rows = document.querySelectorAll("#billBody tr");
    rows.forEach((row, index) => {
        row.cells[0].innerText = index + 1;
    });
}

function calculateTotals() {
    let grandTotal = 0;
    const rows = document.querySelectorAll("#billBody tr");
    rows.forEach(row => {
        const area = parseFloat(row.querySelector(".area")?.value || 0);
        const unit = parseFloat(row.querySelector(".unit")?.value || 0);
        const total = area * unit;
        row.querySelector(".total").value = total.toFixed(2);
        grandTotal += total;
    });
    document.getElementById("grandTotal").innerText = grandTotal.toFixed(2);
}

function downloadPDF() {
    const original = document.getElementById("billContent");

    // Clone only the inner HTML, including current form values
    const clone = original.cloneNode(true);

    // Replace all inputs in the clone with their values
    const rows = clone.querySelectorAll("tbody tr");
    rows.forEach(row => {
        const cells = row.querySelectorAll("td");

        let area = 0, unitPrice = 0;

        cells.forEach((cell, index) => {
            const input = cell.querySelector("input");
            if (input) {
                const value = input.value || "";
                const text = document.createElement("span");
                text.textContent = value;
                text.style.display = "inline-block";
                text.style.minWidth = "60px";
                cell.replaceChild(text, input);

                if (index === 2) area = parseFloat(value) || 0;
                if (index === 3) unitPrice = parseFloat(value) || 0;
            }
        });

        // Calculate and insert total
        const total = (area * unitPrice).toFixed(2);
        const totalCell = cells[4];
        totalCell.textContent = total;
    });

    // Remove delete buttons
    const buttons = clone.querySelectorAll("button");
    buttons.forEach(btn => btn.remove());

    // Create container and append clone for rendering
    const container = document.createElement("div");
    container.appendChild(clone);

    // Generate PDF
    const opt = {
        margin:       0.5,
        filename:     `Furniture-Bill-${new Date().toISOString().slice(0,10)}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    html2pdf().from(container).set(opt).save();
}
</script>

</body>
</html>
