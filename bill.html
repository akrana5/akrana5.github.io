
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Generate Bill</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 40px;
      background-color: #f5f5f5;
    }

    h2 {
      text-align: center;
    }

    .input-group {
      margin-bottom: 15px;
    }

    label {
      display: inline-block;
      width: 100px;
      font-weight: bold;
    }

    input {
      padding: 6px;
      margin-right: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #e9ecef;
    }

    .no-border {
      border: none !important;
    }

    .actions {
      margin-top: 20px;
    }

    button {
      padding: 10px 16px;
      margin-right: 10px;
      font-weight: bold;
    }

    #billSection {
      margin-top: 40px;
      background-color: white;
      padding: 20px;
      border: 1px solid #ccc;
    }

    .total-row {
      font-weight: bold;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

<h2>Furniture Work Bill</h2>

<div class="input-group">
  <label>Client:</label>
  <input type="text" id="clientName" />
  <label>Date:</label>
  <input type="date" id="billDate" />
</div>

<table id="itemsTable">
  <thead>
    <tr>
      <th>S.No</th>
      <th>Description</th>
      <th>Area (Sq.Ft)</th>
      <th>Unit Price</th>
      <th>Total</th>
      <th class="no-border"><button onclick="addRow()">➕</button></th>
    </tr>
  </thead>
  <tbody id="itemRows">
    <tr>
      <td>1</td>
      <td><input type="text" class="desc" /></td>
      <td><input type="number" class="area" oninput="calculateTotals()" /></td>
      <td><input type="number" class="unit" oninput="calculateTotals()" /></td>
      <td><input type="text" class="total" readonly /></td>
      <td class="no-border"><button onclick="removeRow(this)">❌</button></td>
    </tr>
  </tbody>
</table>

<div class="actions">
  <button onclick="generateBill()">Generate Bill</button>
  <button onclick="exportPDF()">Save as PDF</button>
  <button onclick="exportWord()">Save as Word</button>
</div>

<div id="billSection"></div>

<script>
function addRow() {
  const table = document.getElementById("itemRows");
  const row = table.insertRow();
  const index = table.rows.length;

  row.innerHTML = `
    <td>${index}</td>
    <td><input type="text" class="desc" /></td>
    <td><input type="number" class="area" oninput="calculateTotals()" /></td>
    <td><input type="number" class="unit" oninput="calculateTotals()" /></td>
    <td><input type="text" class="total" readonly /></td>
    <td class="no-border"><button onclick="removeRow(this)">❌</button></td>
  `;
}

function removeRow(button) {
  const row = button.closest("tr");
  row.remove();
  updateSno();
  calculateTotals();
}

function updateSno() {
  const rows = document.querySelectorAll("#itemRows tr");
  rows.forEach((row, index) => {
    row.cells[0].textContent = index + 1;
  });
}

function calculateTotals() {
  const rows = document.querySelectorAll("#itemRows tr");
  rows.forEach(row => {
    const area = parseFloat(row.querySelector(".area")?.value || 0);
    const unit = parseFloat(row.querySelector(".unit")?.value || 0);
    const total = row.querySelector(".total");
    total.value = (area * unit).toFixed(2);
  });
}

function generateBill() {
  const client = document.getElementById("clientName").value || "-";
  const date = document.getElementById("billDate").value || "-";
  let totalSum = 0;

  let html = `
    <h3 style="text-align:center;">Furniture Work Bill</h3>
    <p><strong>Client:</strong> ${client}<br><strong>Date:</strong> ${date}</p>
    <table>
      <tr>
        <th>S.No</th>
        <th>Description</th>
        <th>Area (Sq.Ft)</th>
        <th>Unit Price</th>
        <th>Total</th>
      </tr>
  `;

  const rows = document.querySelectorAll("#itemRows tr");
  rows.forEach((row, index) => {
    const desc = row.querySelector(".desc")?.value || "-";
    const area = row.querySelector(".area")?.value || "0";
    const unit = row.querySelector(".unit")?.value || "0";
    const total = (row.querySelector(".total")?.value || "0");
    totalSum += parseFloat(total);

    html += `
      <tr>
        <td>${index + 1}</td>
        <td>${desc}</td>
        <td>${area}</td>
        <td>${unit}</td>
        <td>${parseFloat(total).toFixed(2)}</td>
      </tr>
    `;
  });

  html += `
    <tr class="total-row">
      <td colspan="4">Grand Total</td>
      <td>${totalSum.toFixed(2)}</td>
    </tr>
    </table>
  `;

  document.getElementById("billSection").innerHTML = html;
}

function exportPDF() {
  generateBill();
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.html(document.getElementById("billSection"), {
    callback: function (doc) {
      doc.save("Furniture_Bill.pdf");
    },
    x: 10,
    y: 10
  });
}

function exportWord() {
  generateBill();
  const content = document.getElementById("billSection").innerHTML;
  const converted = window.htmlDocx.asBlob('<html><body>' + content + '</body></html>');
  const link = document.createElement('a');
  link.href = URL.createObjectURL(converted);
  link.download = 'Furniture_Bill.docx';
  link.click();
}
</script>

</body>
</html>
