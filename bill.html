<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Furniture Bill</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }
    .btn {
      padding: 8px 12px;
      margin: 10px 0;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    input {
      width: 100%;
      border: none;
      text-align: center;
    }
  </style>
</head>
<body>

<div id="billContent">
  <h2>Rana Wood Works, Vapi</h2>
    <h2>Prop - Lalu Rana</h2>
<h2>Phone - 6200421418</h2>
<h3>Address - Vapi, Gujarat</h3>
  <table id="billTable">
    <thead>
      <tr>
        <th>S.No.</th>
        <th>Description</th>
        <th>Area (sq. ft)</th>
        <th>Unit Price</th>
        <th>Total</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="lineItems">
      <tr>
        <td>1</td>
        <td><input type="text" placeholder="Description" /></td>
        <td><input type="number" oninput="calculateTotal(this)" /></td>
        <td><input type="number" oninput="calculateTotal(this)" /></td>
        <td class="totalCell">0.00</td>
        <td><button onclick="deleteRow(this)">❌</button></td>
      </tr>
    </tbody>
  </table>
  <button class="btn" onclick="addRow()">+ Add Item</button>
</div>

<button class="btn" onclick="downloadPDF()">Download PDF</button>

<script>
function addRow() {
  const tbody = document.getElementById("lineItems");
  const rowCount = tbody.rows.length;
  const row = tbody.insertRow();

  row.innerHTML = `
    <td>${rowCount + 1}</td>
    <td><input type="text" placeholder="Description" /></td>
    <td><input type="number" oninput="calculateTotal(this)" /></td>
    <td><input type="number" oninput="calculateTotal(this)" /></td>
    <td class="totalCell">0.00</td>
    <td><button onclick="deleteRow(this)">❌</button></td>
  `;
}

function deleteRow(btn) {
  const row = btn.closest("tr");
  row.remove();
  updateSno();
}

function updateSno() {
  const rows = document.querySelectorAll("#lineItems tr");
  rows.forEach((row, index) => {
    row.cells[0].textContent = index + 1;
  });
}

function calculateTotal(input) {
  const row = input.closest("tr");
  const area = parseFloat(row.cells[2].querySelector("input").value) || 0;
  const price = parseFloat(row.cells[3].querySelector("input").value) || 0;
  row.cells[4].textContent = (area * price).toFixed(2);
}

function downloadPDF() {
  // Clone the content to avoid affecting the live DOM
  const original = document.getElementById("billContent");
  const clone = original.cloneNode(true);

  // Convert all input fields to span with values
  clone.querySelectorAll("input").forEach(input => {
    const value = input.value;
    const span = document.createElement("span");
    span.textContent = value || "-";
    input.parentNode.replaceChild(span, input);
  });

  // Remove action buttons
  clone.querySelectorAll("button").forEach(btn => btn.remove());

  // Create wrapper div to render properly
  const wrapper = document.createElement("div");
  wrapper.appendChild(clone);
  document.body.appendChild(wrapper);

  const opt = {
    margin:       0.5,
    filename:     `Furniture-Bill-${new Date().toISOString().slice(0,10)}.pdf`,
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  { scale: 2 },
    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().from(wrapper).set(opt).save().then(() => {
    document.body.removeChild(wrapper); // clean up
  });
}
</script>

</body>
</html>
